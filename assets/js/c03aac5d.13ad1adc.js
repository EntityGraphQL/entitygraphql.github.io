"use strict";(self.webpackChunkentity_graphql_docs=self.webpackChunkentity_graphql_docs||[]).push([[892],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,s=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=l(r),h=o,m=u["".concat(c,".").concat(h)]||u[h]||d[h]||s;return r?n.createElement(m,a(a({ref:t},p),{},{components:r})):n.createElement(m,a({ref:t},p))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=r.length,a=new Array(s);a[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,a[1]=i;for(var l=2;l<s;l++)a[l]=r[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},6460:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var n=r(7462),o=(r(7294),r(3905));const s={sidebar_position:9},a="Adding Other Data Sources",i={unversionedId:"schema-creation/other-data-sources",id:"schema-creation/other-data-sources",title:"Adding Other Data Sources",description:"EntityGraphQL lets you add fields that resolve data from other sources other than the core context you created your schema with. This is powerful as it let's you create a single API that brings together multiple data sources into an object graph.",source:"@site/docs/schema-creation/other-data-sources.md",sourceDirName:"schema-creation",slug:"/schema-creation/other-data-sources",permalink:"/docs/schema-creation/other-data-sources",draft:!1,editUrl:"https://github.com/EntityGraphQL/EntityGraphQL/tree/master/docs/docs/schema-creation/other-data-sources.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"Directives",permalink:"/docs/schema-creation/directives"},next:{title:"Serialization & Field Naming",permalink:"/docs/serialization-naming/"}},c={},l=[{value:"<code>ResolveWithService&lt;TService&gt;()</code> Fields",id:"resolvewithservicetservice-fields",level:2},{value:"Services With Non-Scalar Types",id:"services-with-non-scalar-types",level:2},{value:"Connecting Back to the Core Context",id:"connecting-back-to-the-core-context",level:2},{value:"Complex Service Types",id:"complex-service-types",level:2}],p={toc:l};function d(e){let{components:t,...r}=e;return(0,o.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"adding-other-data-sources"},"Adding Other Data Sources"),(0,o.kt)("p",null,"EntityGraphQL lets you add fields that resolve data from other sources other than the core context you created your schema with. This is powerful as it let's you create a single API that brings together multiple data sources into an object graph."),(0,o.kt)("h2",{id:"resolvewithservicetservice-fields"},(0,o.kt)("inlineCode",{parentName:"h2"},"ResolveWithService<TService>()")," Fields"),(0,o.kt)("p",null,"To use other services in a field we use the ",(0,o.kt)("inlineCode",{parentName:"p"},"ResolveWithService<TService>()")," method on the field. EntityGraphQL uses the ",(0,o.kt)("inlineCode",{parentName:"p"},"IServiceProvider")," you pass on execution to resolve the services."),(0,o.kt)("p",null,"Let's use a service in our ",(0,o.kt)("inlineCode",{parentName:"p"},"Person")," type example."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cs"},'schema.UpdateType<Person>(personType => {\n    personType.AddField("age", "Person\'s age")\n        .ResolveWithService<IAgeService>((person, srv) => srv.GetAge(person.Dob));\n});\n\n// Startup.cs\nservices.AddSingleton<IAgeService, AgeService>();\n\n// AgeService.cs\npublic class AgeService\n{\n    public int GetAge(DateTime dob)\n    {\n        return (now - dob).TotalYears;\n    }\n}\n')),(0,o.kt)("p",null,"Now when someone requests the ",(0,o.kt)("inlineCode",{parentName:"p"},"age")," field on a person the result will be resolved by executing the service ",(0,o.kt)("inlineCode",{parentName:"p"},"srv.GetAge(person.Dob)"),". Of course you could calculate the age directly in the field's resolve expression without a service but this demonstrates how to use other services."),(0,o.kt)("h2",{id:"services-with-non-scalar-types"},"Services With Non-Scalar Types"),(0,o.kt)("p",null,"A service can return any type. If it is a complex type you will need to add it to the schema."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cs"},'schema.Query().AddField("users", "Get list of users")\n    .ResolveWithService<IUserService>(\n        // ctx is the core context we created the schema with. For this field we don\'t use it\n        (ctx, srv) => srv.GetUsers(),\n    );\n\nschema.AddType<User>("User", "User information")\n    .AddAllFields();\n\npublic class UserService : IUserService\n{\n    public List<User> GetUsers() { ... }\n}\n\npublic class User\n{\n    public int Id { get; set; }\n    public string Email { get; set; }\n}\n')),(0,o.kt)("h2",{id:"connecting-back-to-the-core-context"},"Connecting Back to the Core Context"),(0,o.kt)("p",null,"With the User example above you might want to add fields to the ",(0,o.kt)("inlineCode",{parentName:"p"},"User")," type that brings in data back from the core context. This let's you create a rich deep object graph for querying."),(0,o.kt)("p",null,"When joining non-core context types back to the core context you need to use ",(0,o.kt)("inlineCode",{parentName:"p"},"ResolveWithService()")," again."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cs"},'schema.UpdateType<User>(userType => {\n    userType.AddField("tasks", "List of projects assigned to the user")\n        .ResolveWithService<DemoContext>(\n            (user, db) => db.Projects.Where(project => project.AssignedToId == user.Id)\n        );\n});\n')),(0,o.kt)("p",null,"Now we get query the user and their projects at the same time."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"query {\n  users {\n    name\n    projects {\n      name\n      summary\n    }\n  }\n}\n")),(0,o.kt)("h2",{id:"complex-service-types"},"Complex Service Types"),(0,o.kt)("p",null,"If the type you want to define in the schema has data resolved from multiple different methods in your service you can create a service type class."),(0,o.kt)("p",null,"Let's say we want a root-level ",(0,o.kt)("inlineCode",{parentName:"p"},"metrics")," field where each sub-field uses a service to load the value. If someone only queries 1 of the fields you don't want all of them to resolve. To achieve this we can do the following."),(0,o.kt)("p",null,"Define a ",(0,o.kt)("inlineCode",{parentName:"p"},"Metrics")," class that uses a service to provide the functionality."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cs"},"public class Metrics\n{\n    private IMetricService m;\n    public Metrics(IMetricService m)\n    {\n        this.m = m;\n    }\n    public int TotalWebhooks => m.TotalWebhooks();\n    public int TotalApiKeys => m.TotalApiKeys();\n    public int TotalUsers => m.TotalUsers();\n}\n")),(0,o.kt)("p",null,"No we can add the types & fields to GraphQL."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cs"},'// add the type\nvar metricsType = adminSchema.AddType<Metrics>("Metrics", "Contains summary metrics")\n    .AddAllFields();\n\n// add the root-level field\nadminSchema.Query().AddField("metrics", "Return summary metrics")\n    .ResolveWithService<IMetricService>(\n        (db, m) => new Metrics(m)\n    );\n}\n')),(0,o.kt)("p",null,"Now we can query"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-graphql"},"{\n  metrics {\n    totalWebhooks\n  }\n}\n")),(0,o.kt)("p",null,"To demonstrate that only the ",(0,o.kt)("inlineCode",{parentName:"p"},"m.TotalWebhooks()")," method is called here is what is produced as the .NET expression."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cs"},"(MyDbContext db, IMetricService m) => {\n    var context = new Metric(m);\n    return new\n    {\n        totalWebhooks = context.TotalWebhooks,\n    }\n};\n")),(0,o.kt)("p",null,"You'll see none of the other fields are in the expression and therefore the methods will not execute."))}d.isMDXComponent=!0}}]);