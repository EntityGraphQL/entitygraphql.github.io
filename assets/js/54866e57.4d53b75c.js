"use strict";(self.webpackChunkentity_graphql_docs=self.webpackChunkentity_graphql_docs||[]).push([[8265],{7924:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"schema-creation/fields","title":"Fields","description":"GraphQL supports arguments on query fields. We saw this already with the SchemaBuilder.FromObject() helper method. It created a field with an id argument to select a single item by id. Of course you can create fields with your own arguments to expand the functionality of you GraphQL APi.","source":"@site/docs/schema-creation/fields.md","sourceDirName":"schema-creation","slug":"/schema-creation/fields","permalink":"/docs/schema-creation/fields","draft":false,"unlisted":false,"editUrl":"https://github.com/EntityGraphQL/EntityGraphQL/tree/master/docs/docs/schema-creation/fields.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Schema Creation","permalink":"/docs/schema-creation/"},"next":{"title":"Mutations","permalink":"/docs/schema-creation/mutations"}}');var i=t(4848),s=t(8453);const a={sidebar_position:1},l="Fields",o={},d=[{value:"Adding a field with an argument",id:"adding-a-field-with-an-argument",level:2},{value:"Required arguments",id:"required-arguments",level:3},{value:"Optional arguments",id:"optional-arguments",level:3},{value:"Default values",id:"default-values",level:3},{value:"Using methods as fields",id:"using-methods-as-fields",level:2},{value:"Note about method execution with EF",id:"note-about-method-execution-with-ef",level:3},{value:"Lazy Loading",id:"lazy-loading",level:4},{value:"EntityFrameworkCore.Projectables Library",id:"entityframeworkcoreprojectables-library",level:4},{value:"Helper methods",id:"helper-methods",level:2},{value:"WhereWhen()",id:"wherewhen",level:3},{value:"Take(int?)",id:"takeint",level:3},{value:"Tracking Argument Values: IArgumentsTracker",id:"tracking-argument-values-iargumentstracker",level:2},{value:"Using IArgumentsTracker with Query Fields",id:"using-iargumentstracker-with-query-fields",level:3},{value:"With Argument Classes",id:"with-argument-classes",level:4}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"fields",children:"Fields"})}),"\n",(0,i.jsxs)(n.p,{children:["GraphQL supports ",(0,i.jsx)(n.a,{href:"https://graphql.org/learn/queries/#arguments",children:"arguments"})," on query fields. We saw this already with the ",(0,i.jsx)(n.code,{children:"SchemaBuilder.FromObject()"})," helper method. It created a field with an ",(0,i.jsx)(n.code,{children:"id"})," argument to select a single item by id. Of course you can create fields with your own arguments to expand the functionality of you GraphQL APi."]}),"\n",(0,i.jsx)(n.h2,{id:"adding-a-field-with-an-argument",children:"Adding a field with an argument"}),"\n",(0,i.jsxs)(n.p,{children:["Arguments are defined using an anonymous object type when defining the field. Let's build the ",(0,i.jsx)(n.code,{children:"id"})," example ourselves."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'// empty schema\nvar schema = new SchemaProvider<DemoContext>();\nschema.AddType<Person>("Person", "Information about a person");\n\n// add our root-level query field with an argument\nschema.Query().AddField(\n    "person",\n    new {\n        id = ArgumentHelper.Required<int>()\n    },\n    (ctx, args) => ctx.People.FirstOrDefault(p => p.Id == args.id),\n    "Fetch person by ID"\n);\n'})}),"\n",(0,i.jsx)(n.p,{children:"Let's break this down."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Each property of the anonymous object will be an argument on the GraphQL field. In this case we have 1 argument named ",(0,i.jsx)(n.code,{children:"id"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ArgumentHelper.Required<T>()"})," lets EntityGraphQL know that the argument is required and will error if it is not supplied in the query"]}),"\n",(0,i.jsx)(n.li,{children:"The field resolve expression now has 2 parameters, the original context and the anonymous object type which at execution time will contain the argument values"}),"\n",(0,i.jsxs)(n.li,{children:["We use the ",(0,i.jsx)(n.code,{children:"args.id"})," to filter the list of people to a single person that will be returned"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["It is worth noting that the GraphQL name of the argument will be that of the property on the anonymous type. In GraphQL arguments typically start with lower case hence we use ",(0,i.jsx)(n.code,{children:"id"}),". If you used ",(0,i.jsx)(n.code,{children:"Id"})," as the argument name in the anonymous object you will need to use ",(0,i.jsx)(n.code,{children:"Id"})," in queries (GraphQL is case sensitive)."]}),"\n",(0,i.jsx)(n.h3,{id:"required-arguments",children:"Required arguments"}),"\n",(0,i.jsxs)(n.p,{children:["As you see above to make an argument required use the ",(0,i.jsx)(n.code,{children:"ArgumentHelper.Required<T>()"})," method."]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../validation",children:"Validation"})," for further information."]}),"\n",(0,i.jsx)(n.h3,{id:"optional-arguments",children:"Optional arguments"}),"\n",(0,i.jsxs)(n.p,{children:["If you want the argument to be optional just set the field to a typed ",(0,i.jsx)(n.code,{children:"null"})," value."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'schema.Query().AddField(\n    "people",\n    new {\n        firstName = (string)null\n    },\n    (ctx, args) => !string.IsNullOrEmpty(args.firstName) ? ctx.People.Where(p => p.FirstName == args.firstName) : ctx.People,\n    "List of people optionally filtered by a first name"\n);\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If the argument is not supplied with a value in the query ",(0,i.jsx)(n.code,{children:"args.firstName"})," will be null. We can use that to optionally filter the data."]}),"\n",(0,i.jsx)(n.h3,{id:"default-values",children:"Default values"}),"\n",(0,i.jsxs)(n.p,{children:["In GraphQL field arguments can have default values. In EntityGraphQL you just set the default value in the anonymous object create. If fact that is what we did above with ",(0,i.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'schema.Query().AddField(\n    "people",\n    new {\n        deleted = false // default value\n    },\n    (ctx, args) => ctx.People.Where(p => p.IsDeleted == args.deleted),\n    "List all active people. Optional list all deleted people"\n);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"using-methods-as-fields",children:"Using methods as fields"}),"\n",(0,i.jsxs)(n.p,{children:["EntityGraphQL can map methods on your classes to query fields using the ",(0,i.jsx)(n.code,{children:"GraphQLFieldAttribute"}),". When using ",(0,i.jsx)(n.code,{children:"SchemaBuilder"})," or ",(0,i.jsx)(n.code,{children:"SchemaType.AddAllFields()"})," EntityGraphQL will add any methods that have the ",(0,i.jsx)(n.code,{children:"GraphQLFieldAttribute"})," as a field on that type. The parameters of the method will become the GraphQL field arguments. Mapping method parameters to GraphQL arguments follow the same rules as mutations and subscription methods."]}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"[GraphQLInputType]"})," on a parameter will include the parameter as an argument and use the type as an input type. ",(0,i.jsx)(n.code,{children:"[GraphQLArguments]"})," will flatten the properties of that parameter type into many arguments in the schema."]}),"\n",(0,i.jsx)(n.p,{children:"When looking for a methods parameters, EntityGraphQL will"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"First all scalar / non-complex types will be added as arguments in the schema."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"If parameter type or enum type is already in the schema it will be added at an argument."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Any argument or type with ",(0,i.jsx)(n.code,{children:"GraphQLInputTypeAttribute"})," will be added to the schema as an ",(0,i.jsx)(n.code,{children:"InputType"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Any argument or type with ",(0,i.jsx)(n.code,{children:"GraphQLArgumentsAttribute"})," found will have the types properties added as schema arguments."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["If no attributes are found it will assume they are services and not add them to the schema. ",(0,i.jsx)(n.em,{children:"I.e. Label your parameters with the attributes or add the type to the schema beforehand."})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"note-about-method-execution-with-ef",children:"Note about method execution with EF"}),"\n",(0,i.jsx)(n.p,{children:"Let's look at an example."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'public class DemoContext : DbContext\n{\n    [Description("Collection of Movies")]\n    public DbSet<Movie> Movies { get; set; }\n    [Description("Collection of Peoples")]\n    public DbSet<Person> People { get; set; }\n    [Description("Collection of Actors")]\n    public DbSet<Actor> Actors { get; set; }\n}\n\npublic class Movie\n{\n    public uint Id { get; set; }\n    public string Name { get; set; }\n\n    // other fields hidden\n\n    public virtual DateTime Released { get; set; }\n    public virtual List<Actor> Actors { get; set; }\n    public virtual Person Director { get; set; }\n\n// highlight-next-line\n    [GraphQLField]\n    public uint DirectorAgeAtRelease => (uint)((Released - Director.Dob).Days / 365);\n}\n\nvar schema = new SchemaProvider<DemoContext>();\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"DirectorAgeAtRelease"})," will become a field ",(0,i.jsx)(n.code,{children:"directorAgeAtRelease"})," on the GraphQL type ",(0,i.jsx)(n.code,{children:"Movie"})," with no arguments. If you query this field like"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-gql",children:"{\n  movies {\n    name\n    directorAgeAtRelease\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"It will generate the follow expression"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:"(ctx) => ctx.Movies.Select(m => new {\n    name = m.Name,\n    directorAgeAtRelease = m.DirectorAgeAtRelease()\n})\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"If you are using EF, it does not know how to translate your method and will try to execute this method after fetching data."})," This issue is the method relies on the ",(0,i.jsx)(n.code,{children:"Director"})," property on ",(0,i.jsx)(n.code,{children:"Movie"})," which EF doesn't know and did not fetch so you will not get the expected result. There are a few solutions to this."]}),"\n",(0,i.jsx)(n.h4,{id:"lazy-loading",children:"Lazy Loading"}),"\n",(0,i.jsxs)(n.p,{children:["One solution is ",(0,i.jsx)(n.a,{href:"https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Proxies/",children:"Microsoft.EntityFrameworkCore.Proxies"})," to lazy load the properties, which comes with its own tradeoffs. If you install the Nuget package and follow the instructions for using lazy loading proxies these methods will work."]}),"\n",(0,i.jsx)(n.h4,{id:"entityframeworkcoreprojectables-library",children:"EntityFrameworkCore.Projectables Library"}),"\n",(0,i.jsxs)(n.p,{children:["Another solution is ",(0,i.jsx)(n.a,{href:"https://github.com/koenbeuk/EntityFrameworkCore.Projectables",children:"EntityFrameworkCore.Projectables"})," (Or ",(0,i.jsx)(n.a,{href:"https://github.com/ClaveConsulting/Expressionify",children:"Expressionify"}),") which uses source generators to generate an EF compatible expression."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:"// configure projectables\nservices.AddDbContext<DemoContext>(opt =>\n// highlight-next-line\n    opt.UseProjectables()\n);\n\n// add the attributes to your methods\n[GraphQLField]\n// highlight-next-line\n[Projectable]\npublic uint DirectorAgeAtRelease => (uint)((Released - Director.Dob).Days / 365);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now the expression will be translated into expression that EF will handle. See ",(0,i.jsx)(n.a,{href:"https://github.com/koenbeuk/EntityFrameworkCore.Projectables",children:"EntityFrameworkCore.Projectables"})," documentation for more information. Or your preferred library."]}),"\n",(0,i.jsxs)(n.p,{children:["These libraries require the methods by expression - For example ",(0,i.jsx)(n.a,{href:"https://github.com/koenbeuk/EntityFrameworkCore.Projectables",children:"EntityFrameworkCore.Projectables"})," will not work for a method like below, ",(0,i.jsx)(n.em,{children:"whereas lazy loading will"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:"[GraphQLField]\n[Projectable] // will fail as it can't generate an expression - does work with lazy loading\npublic uint[] AgesOfActorsAtRelease()\n{\n    var ages = new List<uint>();\n    foreach (var actor in Actors)\n    {\n        ages.Add((uint)((Released - actor.Person.Dob).Days / 365));\n    }\n    return ages.ToArray();\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"helper-methods",children:"Helper methods"}),"\n",(0,i.jsx)(n.h3,{id:"wherewhen",children:"WhereWhen()"}),"\n",(0,i.jsxs)(n.p,{children:["The conditional statement we saw above - ",(0,i.jsx)(n.code,{children:"!string.IsNullOrEmpty(args.firstName) ? ctx.People.Where(p => p.FirstName == args.firstName) : ctx.People"})," - can start to get messy when you have multiple optional arguments. It is common to have multiple arguments on fields that return a list of items to filter for different uses. To aid this EntityGraphQL has a helper method ",(0,i.jsx)(n.code,{children:"WhereWhen()"})," that only applies a ",(0,i.jsx)(n.code,{children:"Where()"})," method if a given statement returns ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'schema.Query().AddField(\n    "people",\n    new {\n        // multiple optional arguments\n        firstName = (string)null,\n        lastName = (string)null\n    },\n    (ctx, args) => ctx.People\n        .WhereWhen(p => p.FistName == args.firstName, !string.IsNullOrEmpty(args.firstName))\n        .WhereWhen(p => p.LastName == args.lastName, !string.IsNullOrEmpty(args.lastName)),\n    "List of people optionally filtered by a first and/or last name"\n);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"takeint",children:"Take(int?)"}),"\n",(0,i.jsxs)(n.p,{children:["Only apply the ",(0,i.jsx)(n.code,{children:"Take()"})," method if the argument has a value."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cs",children:'schema.Query().AddField("Field", new { limit = (int?)null }, (db, p) => db.Entity.Take(p.limit), "description");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"tracking-argument-values-iargumentstracker",children:"Tracking Argument Values: IArgumentsTracker"}),"\n",(0,i.jsx)(n.p,{children:'EntityGraphQL provides a way to help you determine if an argument or input property was explicitly set by the user in a query or mutation, or if it is just the default .NET value. This is useful for distinguishing between "not provided" and "provided as null/default".'}),"\n",(0,i.jsx)(n.h3,{id:"using-iargumentstracker-with-query-fields",children:"Using IArgumentsTracker with Query Fields"}),"\n",(0,i.jsx)(n.h4,{id:"with-argument-classes",children:"With Argument Classes"}),"\n",(0,i.jsxs)(n.p,{children:["If your argument class implements the ",(0,i.jsx)(n.code,{children:"IArgumentsTracker"})," interface (or inherits from the provided ",(0,i.jsx)(n.code,{children:"ArgumentsTracker"})," base class), you can check if a property was set by the user:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'public class PersonFilter : ArgumentsTracker {\n    public string? Name { get; set; }\n    public int? MinAge { get; set; }\n    public string? City { get; set; }\n}\n\n// In your field - only filter by fields that were provided\nschema.Query().AddField(\n    "people",\n    new PersonFilter(),\n    (db, args) => db.People\n        .WhereWhen(p => p.Name.Contains(args.Name), args.IsSet(nameof(PersonFilter.Name)))\n        .WhereWhen(p => p.Age >= args.MinAge, args.IsSet(nameof(PersonFilter.MinAge)))\n        .WhereWhen(p => p.City == args.City, args.IsSet(nameof(PersonFilter.City))),\n    "Get people with optional filtering"\n);\n'})}),"\n",(0,i.jsx)(n.p,{children:"This works consistently with both inline arguments and variables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:'# Using variables\nquery GetPeople($filter: PersonFilter) {\n    people(name: $filter.name, city: $filter.city) { id name age city }\n}\n# Variables: { "filter": { "name": "John", "city": null } }\n\n# Using inline arguments\nquery {\n    people(name: "John", city: null) { id name age city }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["In both cases, only the ",(0,i.jsx)(n.code,{children:"name"})," and ",(0,i.jsx)(n.code,{children:"city"})," filters will be applied, even though ",(0,i.jsx)(n.code,{children:"city"})," is explicitly set to ",(0,i.jsx)(n.code,{children:"null"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>l});var r=t(6540);const i={},s=r.createContext(i);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);